(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{126:function(e,t,o){"use strict";t.a={computed:{apiUsuario:function(){return this.$store.state.ogapi.user},$api:function(){return this.$store.state.ogapi.api}}}},130:function(e,t,o){"use strict";t.a={computed:{textField:function(){return this.$store.state.appbar.textField},tab:function(){return this.$store.state.appbar.tabActive}}}},191:function(e,t,o){"use strict";var n=o(88).a,_=(o(243),o(19)),component=Object(_.a)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-app",{attrs:{id:"inspire"}},[o("v-app-bar",{attrs:{extended:"",app:"",color:"primary",dense:"",dark:"","elevate-on-scroll":""},scopedSlots:e._u([{key:"extension",fn:function(){return[e.deviceId?e._e():o("v-text-field",{attrs:{label:"Search device",clearable:"","single-line":"",solo:"","solo-inverted":"","hide-details":"",dense:"","append-icon":"mdi-magnify"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)},"click:append":e.search,"click:clear":e.search},model:{value:e.field,callback:function(t){e.field=t},expression:"field"}}),e._v(" "),e.deviceId?o("v-tabs",{staticClass:"no-mobile",attrs:{grow:"",centered:"",dense:"","icons-and-text":""},model:{value:e.tabActivo,callback:function(t){e.tabActivo=t},expression:"tabActivo"}},[o("v-tab",{staticClass:"ma-0",attrs:{href:"#system"}},[o("span",[e._v("System")]),e._v(" "),o("v-icon",[e._v("mdi-cellphone-link")])],1),e._v(" "),o("v-tab",{staticClass:"ma-0",attrs:{href:"#sensors"}},[o("span",[e._v("Sensors")]),e._v(" "),o("v-icon",[e._v("mdi-list-status")])],1),e._v(" "),o("v-tab",{staticClass:"ma-0",attrs:{href:"#operations"}},[o("span",[e._v("Operations")]),e._v(" "),o("v-icon",[e._v("mdi-cog")])],1),e._v(" "),o("v-tab",{staticClass:"ma-0",attrs:{href:"#eventos"}},[o("span",[e._v("Events")]),e._v(" "),o("v-icon",[e._v("mdi-calendar-alert")])],1),e._v(" "),o("v-tab",{staticClass:"ma-0",attrs:{href:"#maps"}},[o("span",[e._v("Map")]),e._v(" "),o("v-icon",[e._v("mdi-map-marker-radius")])],1)],1):e._e()]},proxy:!0}])},[e.deviceId?o("v-app-bar-nav-icon",{on:{click:e.routerlister}},[o("v-icon",[e._v(" mdi-chevron-left ")])],1):e._e(),e._v(" "),o("v-toolbar-title",[e._v("\r\n            "+e._s(e.deviceId?e.deviceId+" Emulator":"Select device to emulate")+"\r\n        ")]),e._v(" "),o("v-spacer"),e._v(" "),o("v-toolbar-items",[o("v-menu",{staticClass:"operationLog",attrs:{width:"500"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,_=t.attrs;return[o("v-btn",e._g(e._b({attrs:{text:""},on:{click:function(t){e.contOperations=0}}},"v-btn",_,!1),n),[o("v-badge",{attrs:{content:e.contOperations,value:e.contOperations,color:"error"}},[e.isEmulatorConnected?o("v-icon",{attrs:{color:"success"}},[e._v("mdi-lan-connect")]):o("v-icon",{attrs:{color:"error"}},[e._v("mdi-lan-disconnect")])],1)],1)]}}]),model:{value:e.logDialog,callback:function(t){e.logDialog=t},expression:"logDialog"}},[e._v(" "),o("v-card",[o("v-card-title",{staticClass:"pa-0"},[o("v-toolbar",{attrs:{flat:"",width:"100%"}},[o("v-toolbar-title",[e._v("Events")]),e._v(" "),o("v-spacer"),e._v(" "),o("v-toolbar-items",[o("v-divider",{attrs:{vertical:"",inset:""}}),e._v(" "),o("v-btn",{attrs:{color:"error",icon:""},on:{click:function(t){e.logDialog=!1}}},[o("v-icon",{attrs:{dark:""}},[e._v("mdi-close")])],1)],1)],1)],1),e._v(" "),o("v-card-text",{staticClass:"pa-1"},[o("v-list",{attrs:{"two-line":""}},e._l(e.eventArr,(function(t,n){return o("v-list-item",{key:t.type+"_"+n},[o("v-list-item-icon",[o("v-icon",{domProps:{textContent:e._s(t.icon)}})],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",{domProps:{textContent:e._s(t.type)}}),e._v(" "),o("v-list-item-subtitle",{staticClass:"text--primary",domProps:{textContent:e._s(t.devId)}}),e._v(" "),o("v-list-item-subtitle",{domProps:{textContent:e._s(t.description)}})],1),e._v(" "),o("v-list-item-action",[o("v-list-item-action-text",{domProps:{textContent:e._s(t.dateTime)}})],1)],1)})),1)],1)],1)],1),e._v(" "),o("v-divider",{attrs:{inset:"",vertical:""}}),e._v(" "),o("v-menu",{staticClass:"logout",attrs:{"close-on-content-click":!0,"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[o("v-btn",e._g({attrs:{text:""}},n),[o("v-icon",[e._v("mdi-menu")])],1)]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[e._v(" "),o("v-card",{staticClass:"card"},[o("v-list-item",[o("v-list-item-icon",[o("v-icon",[e._v("\r\n                                mdi-email\r\n                            ")])],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",[e._v(e._s(this.$store.state.appbar.user))]),e._v(" "),o("v-list-item-subtitle",[e._v("User")])],1)],1),e._v(" "),e.deviceId?o("div",{staticClass:"mobile"},[o("v-list-item",{on:{click:function(t){return e.setContent("system")}}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-cellphone-link")])],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",[e._v("System")])],1)],1),e._v(" "),o("v-list-item",{on:{click:function(t){return e.setContent("sensors")}}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-list-status")])],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",[e._v("Sensors")])],1)],1),e._v(" "),o("v-list-item",{on:{click:function(t){return e.setContent("operations")}}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-cog")])],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",[e._v("Operations")])],1)],1),e._v(" "),o("v-list-item",{on:{click:function(t){return e.setContent("eventos")}}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-calendar-alert")])],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",[e._v("Events")])],1)],1),e._v(" "),o("v-list-item",{on:{click:function(t){return e.setContent("maps")}}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-map-marker-radius")])],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",[e._v("Map")])],1)],1)],1):e._e(),e._v(" "),o("v-dialog",{attrs:{persistent:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,_=t.attrs;return[o("v-list-item",e._g(e._b({},"v-list-item",_,!1),n),[o("v-list-item-icon",[o("v-icon",[e._v("mdi-logout")])],1),e._v(" "),o("v-list-item-content",[o("v-list-item-title",[e._v("Logout")])],1)],1)]}}]),model:{value:e.logoutDialog,callback:function(t){e.logoutDialog=t},expression:"logoutDialog"}},[e._v(" "),o("v-card",[o("v-card-title",{staticClass:"headline"},[e._v(" ATTENTION ")]),e._v(" "),o("v-card-text",[e._v("Are you sure?")]),e._v(" "),o("v-card-actions",[o("v-spacer"),e._v(" "),o("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(t){e.logoutDialog=!1}}},[e._v("\r\n                                    No\r\n                                ")]),e._v(" "),o("v-btn",{attrs:{color:"red",text:""},on:{click:e.routerdialog}},[e._v(" YES ")])],1)],1)],1)],1)],1)],1)],1),e._v(" "),o("v-main",[o("Nuxt")],1)],1)}),[],!1,null,"5c65847a",null);t.a=component.exports},192:function(e,t,o){"use strict";var n=o(19),component=Object(n.a)({},(function(){var e=this.$createElement;return(this._self._c||e)("nuxt")}),[],!1,null,null,null);t.a=component.exports},198:function(e,t,o){o(199),e.exports=o(200)},229:function(e,t,o){"use strict";var n=o(86);o.n(n).a},230:function(e,t,o){(t=o(46)(!1)).push([e.i,"h1[data-v-bfedb7fe]{font-size:20px}",""]),e.exports=t},243:function(e,t,o){"use strict";var n=o(89);o.n(n).a},244:function(e,t,o){(t=o(46)(!1)).push([e.i,".menu[data-v-5c65847a],.mobile[data-v-5c65847a]{display:none}.no-mobile[data-v-5c65847a]{display:block}@media only screen and (max-width:768px){.nav_item[data-v-5c65847a]{display:none}.menu[data-v-5c65847a],.mobile[data-v-5c65847a]{display:block}.no-mobile[data-v-5c65847a]{display:none}}.logout[data-v-5c65847a],.operationLog[data-v-5c65847a]{z-index:9999}",""]),e.exports=t},245:function(e,t,o){"use strict";o.r(t),o.d(t,"state",(function(){return n})),o.d(t,"mutations",(function(){return _}));o(246);var n=function(){return{api:null,user:null}},_={setOgapi:function(e,t){var o=t.config;e.user=o.user,e.api=new window.OpenGateAPI({apiKey:o.user?o.user.apiKey:null,url:(o.serverUrl||"https://api.opengate.es")+"/north/v80",timeout:12e4,south:{url:(o.serverUrl||"https://api.opengate.es")+"/south/v80"}})},setOgapiKey:function(e,t){var o=t.config;e.api=new window.OpenGateAPI({apiKey:o.key,url:(o.serverUrl||"https://api.opengate.es")+"/north/v80",timeout:12e4,south:{url:(o.serverUrl||"https://api.opengate.es")+"/south/v80"}})},removeApiKey:function(e){e.user=null,e.api=new window.OpenGateAPI({apiKey:null,url:(config.serverUrl||"https://opengate.es")+"/north/v80",timeout:12e4,south:{url:(config.serverUrl||"https://opengate.es")+"/south/v80"}})}}},247:function(e,t,o){"use strict";o.r(t),o.d(t,"state",(function(){return n})),o.d(t,"mutations",(function(){return _}));var n=function(){return{textField:null,tabActive:null,user:null}},_={setFilter:function(e,t){var text=t.text;e.textField&&(e.textField=null),e.textField=text},setTab:function(e,t){var o=t.tab;e.tabActive=o},setUser:function(e,t){var o=t.email;e.user=o}}},41:function(e,t,o){"use strict";var n={layout:"empty",props:{error:{type:Object,default:null}},data:function(){return{pageNotFound:"404 Not Found",otherError:"An error occurred"}},head:function(){return{title:404===this.error.statusCode?this.pageNotFound:this.otherError}}},_=(o(229),o(19)),component=Object(_.a)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-app",{attrs:{dark:""}},[404===e.error.statusCode?o("h1",[e._v("\n    "+e._s(e.pageNotFound)+"\n  ")]):o("h1",[e._v("\n    "+e._s(e.otherError)+"\n  ")]),e._v(" "),o("NuxtLink",{attrs:{to:"/"}},[e._v("\n    Home page\n  ")])],1)}),[],!1,null,"bfedb7fe",null);t.a=component.exports},86:function(e,t,o){var content=o(230);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(47).default)("7388ab72",content,!0,{sourceMap:!1})},88:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_symbol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20),core_js_modules_es_symbol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_symbol__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(42),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(193),core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(16),core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_object_get_own_property_descriptor__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(59),core_js_modules_es_object_get_own_property_descriptor__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_object_get_own_property_descriptor__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(60),core_js_modules_es_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_object_keys__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(48),core_js_modules_es_object_keys__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_object_keys__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(29),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_web_timers__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(58),core_js_modules_web_timers__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_web_timers__WEBPACK_IMPORTED_MODULE_9__),_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(25),vuex__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(45),_mixins_textField_mixin_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(130),_mixins_baseUserApi_mixin_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(126);function ownKeys(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(t){Object(_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_10__.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}__webpack_exports__.a={mixins:[_mixins_baseUserApi_mixin_js__WEBPACK_IMPORTED_MODULE_13__.a,_mixins_textField_mixin_js__WEBPACK_IMPORTED_MODULE_12__.a],data:function(){return{eventArr:[],contOperations:0,deviceapi:[],todo:!0,devices:[],field:null,logDialog:!1,logoutDialog:!1,valid:!1,tabActivo:"system",menu:!1,mqttClient:null,socketConnected:null,send:!1,operationResponse:{operation:{response:{}}}}},methods:_objectSpread(_objectSpread({},Object(vuex__WEBPACK_IMPORTED_MODULE_11__.b)({sendText:"appbar/setFilter",setTab:"appbar/setTab"})),{},{setContent:function(e){this.tabActivo=e},routerdialog:function(){localStorage.checkbox=!1,this.$router.push({path:"/"})},routerlister:function(e){this.tabActivo="system",this.$router.push({path:"/listerpage"})},search:function(){this.sendText({text:this.field})},buildResponse:function(e,t){return{operation:{response:{name:t.operation.request.name,timestamp:t.operation.request.timespamp,id:t.operation.request.id,resultCode:e,resultDescription:e}}}},sendResponse:function(e){var t=this;setTimeout((function(){t.mqttClient.send(JSON.stringify(e))}),1e3)},deviceConnect:function deviceConnect(){var _this2=this;try{this.mqttClient&&this.mqttClient.close&&this.mqttClient.close(),this.mqttClient=new WebSocket("wss://api.opengate.es/south/v80/sessions/"+this.deviceId+"?X-ApiKey="+this.apiUsuario.apiKey),this.mqttClient.onmessage=function(event){if(console.log(event),event.data){_this2.contOperations++;var eventObj=JSON.parse(event.data);if(localStorage&&localStorage.operationsConfig){var operaConfigs=JSON.parse(localStorage.operationsConfig);if(_this2.date=new Date,_this2.time=_this2.date.getHours()+":"+_this2.date.getMinutes(),operaConfigs[_this2.deviceId])if(operaConfigs[_this2.deviceId][eventObj.operation.request.name]&&operaConfigs[_this2.deviceId][eventObj.operation.request.name].enabled){var functionCode="(function(operaRequest, operaResponse){\n"+operaConfigs[_this2.deviceId][eventObj.operation.request.name].code+"\nreturn operaResponse})",functionObj=eval(functionCode);try{var response=_this2.buildResponse("SUCCESSFUL",eventObj);response=functionObj(eventObj.operation.request,response),_this2.sendResponse(response),_this2.eventArr.push({icon:"mdi-thumb-up",type:"SUCCESSFUL",description:eventObj.operation.request.name,devId:_this2.deviceId,dateTime:(new Date).toLocaleString()})}catch(e){console.error(e)}}else if(operaConfigs[_this2.deviceId][eventObj.operation.request.name]){var _response=_this2.buildResponse("NOT_SUPPORTED",eventObj);_this2.sendResponse(_response),console.error("no soportada la operación "+eventObj.operation.request.name),_this2.eventArr.push({icon:"mdi-thumb-down",type:"NOT_SUPPORTED",description:eventObj.operation.request.name,devId:_this2.deviceId,dateTime:(new Date).toLocaleString()})}else{var _response2=_this2.buildResponse("CANCELLED",eventObj);_this2.sendResponse(_response2),console.error(failure),_this2.eventArr.push({icon:"mdi-thumb-down",type:"CANCELLED",description:eventObj.operation.request.name,devId:_this2.deviceId,dateTime:(new Date).toLocaleString()})}else{var _response3=_this2.buildResponse("NOT_SUPPORTED",eventObj);_this2.sendResponse(_response3),console.error("NOT_SUPPORTED"),_this2.eventArr.push({icon:"mdi-thumb-down",type:"NOT_SUPPORTED",description:eventObj.operation.request.name,devId:_this2.deviceId,dateTime:(new Date).toLocaleString()})}}else{var _response4=_this2.buildResponse("NOT_CONFIGURED",eventObj);_this2.sendResponse(_response4),_this2.eventArr.push({icon:"mdi-thumb-down",type:"NOT_CONFIGURED",description:eventObj.operation.request.name,devId:_this2.deviceId,dateTime:(new Date).toLocaleString()})}}},this.mqttClient.onopen=function(e){console.log(e),console.log("Successfully connected to the echo websocket server..."),_this2.contOperations++,_this2.socketConnected=!0,_this2.eventArr.push({icon:"mdi-lan-connect",type:"Connect",devId:_this2.deviceId,dateTime:(new Date).toLocaleString()})},this.mqttClient.onclose=function(e){_this2.contOperations++,_this2.eventArr.push({icon:"mdi-lan-disconnect",type:"Disconnect",devId:_this2.deviceId,dateTime:(new Date).toLocaleString()}),_this2.socketConnected&&_this2.deviceConnect()},this.mqttClient.onerror=function(e){_this2.contOperations++,_this2.socketConnected&&_this2.deviceConnect(),_this2.eventArr.push({icon:"mdi-thumb-down",type:"Error",devId:_this2.deviceId,dateTime:(new Date).toLocaleString()})}}catch(e){this.mqttClient=null,this.socketConnected=!1,this.contOperations++,console.error(e),this.eventArr.push({type:"Error",devId:this.deviceId,dateTime:(new Date).toLocaleString(),description:conError}),this.mqttClient&&this.mqttClient.close&&this.mqttClient.close()}}}),computed:{operationCount:function(){this.event&&contOperations++},isEmulatorConnected:function(){return this.deviceId&&this.socketConnected},deviceId:function(){return this.$route.query.id},render:function(){return"lister"===this.$store.state.appbar.currentPage}},mounted:function(){},created:function(){this.$api||this.$router.push({path:"/"})},watch:{tabActivo:{handler:function(e,t){this.setTab({tab:this.tabActivo})}},deviceId:function(e,t){e&&e!==t?(this.eventArr.splice(0,this.eventArr.length),this.contOperations=0,this.deviceConnect()):(this.socketConnected=!1,this.mqttClient&&this.mqttClient.close&&this.mqttClient.close())},tab:function(){this.tabActivo=this.tab}}}},89:function(e,t,o){var content=o(244);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(47).default)("5054df41",content,!0,{sourceMap:!1})}},[[198,6,2,7]]]);